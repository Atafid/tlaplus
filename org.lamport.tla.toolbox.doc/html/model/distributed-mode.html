<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- This is file org.lamport.tla.toobox.doc/html/model/overview-page.html  -->

 
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <LINK href="../style.css" rel="stylesheet" type="text/css">

<title>Running TLC in Distributed Mode</title>
</head>
<!-- a comment here -->

<body>
<h1>Running TLC in Distributed Mode</h1>

<pre>
Contents
  <a href="#how-it-works">How Distributed TLC Works</a>
  <a href="#running-master">Running the Master from the Toolbox</a>
  <a href="#running-workers">Running the Workers</a>
  <a href="#limitations">Limitations of Distributed Mode </a>
  <a href="#help">Getting and Giving Help</a>
</pre>


<a name="how-it-works"></a><h2>How Distributed TLC Works</h2>

TLC consists of a collection of worker threads that do the actual
model checking--that is, they compute the graph of reachable states
and check invariants and other safety properties.&nbsp; There is also
a master thread that coordinates the worker threads.&nbsp; In ordinary
(non-distributed) mode, these threads all run on the same Java Virtual
Machine (JVM) on the same computer as the Toolbox.&nbsp; In
distributed mode, each thread runs under its own JVM, usually on
different computers.&nbsp; The master thread runs on the same computer
as the Toolbox.&nbsp; (In network terminology, the master is a server
and the workers are clients.)&nbsp; The master and the workers are
started separately, in any order.


<a name="running-master"></a><h2>Running the Master from the Toolbox</h2>

<p>
TLC is run on a <a href="creating-model.html">model</a>.&nbsp;  

To specify that it is to be run in distributed mode, check the <i>Run
in distributed mode</i> box in the 
<a href="overview-page.html#how-to-run">How to run?</a>  section
of the Model Overview Page.
</p>

<p> 
Unless you're just trying it out, you're running TLC in
distributed mode because your model is quite large.&nbsp;  

For any large model, it's a good idea to increase the <i>Maximum JVM
heap size in MB</i> value to give TLC as much of the computer's memory
as is not needed by the operating system and other programs that will
be running at the same time.&nbsp;  (Note that the <i>Number of worker
threads</i> parameter in the <i>How to run</i> section applies only to
running TLC in ordinary, non-distributed mode.)

For distributed mode, you may also want to add special arguments to
the command that launches the JVM that runs the master.&nbsp; As
explained <a href="#possible-problem">below</a>, one such argument may
be needed for the master and the workers to communicate.&nbsp; The
arguments are put in the <i>Additional JVM arguments</i> field.  </p>

<p> You start a TLC run in distributed mode as usual by clicking on
the <IMG SRC="run-icon.gif" Align="bottom"/> button, by selecting
<i>Run model</i> on the <i>TLC Model Checker</i> menu, or by typing
F11.&nbsp; This should cause the <i>Current status</i> field of the <a
href="results-page.html">Model Checking Results Page</a> to change to
<i>Master is waiting for (remote) workers</i> and then to indicate
that one or more workers have registered with the master.  </p>

<a name="running-workers"></a><h2>Running the Workers</h2>

<p>
The following are the basic steps that must be accomplished to start
the workers.&nbsp;  The details of how these steps are performed will vary
according to the operating system and network configuration that you
are using.&nbsp;  For help getting the workers started on your system,
go to (web page).
</p>

<p>
To run the workers, you must have a network of computers that can
communicate with one another and with the machine running the master
and the Toolbox.&nbsp;  We assume that there is some some remote
management/administration system installed on the computers that run
the workers.&nbsp;  Examples of such a system are Remote Desktop (Windows),
ssh, rsh, and telnet.&nbsp;  A Java Runtime Environment (JRE), version 1.5
or later, must also be installed on the macines.&nbsp;
</p>

<p>
There are two basic ways to run a worker thread on a computer that we
will call the worker computer.&nbsp;  In the following instructions,
master-computer is the name of the computer running the Toolbox and
the master.
</p>

<dl>
<dt><b>Method 1</b></dt>
<dd>
Start the Toolbox on the master computer.&nbsp;  Then execute the
following command in a shell on the worker computer:
<pre>
   wget http://master-computer:10996/files/tla2tools.jar
</pre>   
Then execute this command on that shell:
<pre>
  java -cp tla2tools.jar tlc2.tool.distributed.TLCWorker master-computer
</pre> The <code>wget</code> command downloads the file
<code>tla2tools.jar</code> into the current directory on the worker
machine, the java command actually starts the worker.&nbsp; The
<code>wget</code> command therefore just has to be executed the first
time you run a worker, and then whenever you install a new version of
the Toolbox.&nbsp; The <code>wget</code> command is not part of
Windows, but can be installed on Windows as part of Cygwin.  </dd>

<dt><b>Method 2</b></dt>
<dd>
Start the Toolbox on the master computer, and then run a Web browser
on the worker computer.&nbsp;  In that web browser, enter the url
<pre>
    http://master-computer:10996
</pre> This will display a Web page containing a Launch button labeled
<i>Launch worker from browser</i>.&nbsp; Clicking on that will
download the file <code>tla2tools.jar</code> and will execute it,
starting the worker.  </dd> </dl>

<h4><a name="possible-problem"></a>A Possible Problem</h4>

The master-computer name you use in the instructions above for running
the workers is usually a name like <code>jones-home-laptop</code> or
<code>tla.msr-inria.inria.fr</code>.&nbsp;  However, some computers have
multiple network interfaces, with different IP addresses--for example,
<code>192.168.1.10</code> and <code>10.10.0.1</code>.&nbsp;  If the master
computer is such a computer, then it's possible that using this name
as the master-computer name in the instructions above will cause the
worker not to be able to communicate with the master because they are
using different IP addresses.&nbsp;  To solve this problem, choose one of
those IP addresses--say <code>192.168.1.10</code>.  Use that address
as the master-computer name in the instructions above for running the
workers, and put the following argument in the <i>Additional JVM
arguments</i> field of the Model Overview's <i>How to run?</i>
section:

<pre>
   -Djava.rmi.server.hostname=192.168.1.10
</pre>

<h4>Using Multi-Core Worker Machines</h4>
Currently, workers are single threaded.&nbsp;  You can take advantage of
multi-core computers by running multiple workers on the same computer,
using one of the previous methods to start each of the workers.&nbsp;
The major disadvantage of doing this is that a separate copy of 
the worker code is loaded into memory for each worker.

<a name="limitations"></a><h2>Limitations of Distributed Mode </h2>

It does not run in depth-first mode or Simulation mode, even if one of
those modes is selected on the 
  <a href="advanced-page.html">Advanced Options Page</a>.&nbsp;

Coverage information is not provided.&nbsp; You should therefore check
a smaller model in ordinary non-distributed mode to make sure that the
specification specifies what you think it does.&nbsp;


<a name="help"></a><h2>Getting and Giving Help</h2>

You may want to run TLC in distributed mode with many workers.&nbsp;
(Very preliminary tests suggest that linear speedup is possible even
with hundreds of workers.)&nbsp; Manually starting so many workers is
not practical.&nbsp; It is possible to implement scripts that can
automate the installation of the JRE and one of the two methods
described above for copying the <code>tla2tools.jar</code> file and
starting the workers.&nbsp; How this is done will depend on the
operating system and network configuration.&nbsp; 
If you need help, try going to 
the
<a href="http://bbpress.tlaplus.net/forum/distributed-tlc" target="_blank">Forum on
Distributed TLC</a> on the 
  <a href="http://tlaplus.net" target="_blank">tlaplus.net page</a>.&nbsp;
If you have successfully run TLC in distributed mode, please use that
Forum to tell others how you did it on your system.
<hr> 
<!-- delete rest of line to comment out 
<dl>
<dt><b><font color=#0000c0>Subtopics</font></b></dt>
<dd> <A href="model-values.html"> Model Values and Symmetry </A></dd>
<dd> <a href="distributed-mode.html">Running TLC in Distributed Mode</a></dd>
</dl>
--> 
<!-- delete rest of line to comment out -->  
<a href = "overview-page.html">&uarr; Model Overview Page</a>
<!-- --> 
</hr>

</body>
</html>
