TLA+ Error Reports That Can Be Mapped to PCal Code
---------------------------------------------------
- Parser Errors

- TLC errors. Expression evaluation in:
   * Initial predicate   
       This seems to just report a single location,
       exactly where the error occurs.
   * process set. (sometimes reports the ProcSet token,
       sometimes it reports no location)
   * expression in statement: can be
      + the expression
      + conjunct of action containing the expression
      + a previous conjunct of that action
      + the last character (and perhaps more) of 
        the first conjunct of that action.
        This seems to be a minor TLC bug

- Error-Trace action location.
  (Double-click needed to go to TLA+ location.)

- Coverage.  Can go to
   * conjunction of action definition
   * variable in UNCHANGED expression
   * variable in vars location

Note: assertion failure error already maps to PCal code location.
(But not if file has been edited since last translator run.)
    
The Structure of the Translation
--------------------------------
<translation> ::=
   <Variables Declaration> 
   <vars Definition>
   [<ProcSet Definition>]0,1
   <Init Definition>
   <Action Def>+
   [<Process Def>]0,1
   <Next Def>
   <Spec Def>
   <Termination Def>

<Action Def> ::=
   <label> ["(self)"]0,1 == 
   "/\" <PC enabling Predicate>
   <Action Body>

<Action Body> ::=
   [   "/\" <Expr> 
     | "/\" <Assignment> 
     | "/\" <If-Then-Else>
   ]*
   ["/\" <pc-assignment>]0,1  \* An outer-most action body must have a pc-assignment
   ["/\" <Unchanged>]0,1      

<Assignment> ::= 
   <Variable>
    "' ="
   [   <Expr>
     | "[" <Variable> "EXCEPT" "!" [ "[self]" ]0,1 
                                   [    "." <String>  
                                     |  "[" <Expr> "]" 
                                   ]*
       "]"
   ]
    
<If-Then-Else> ::=
   "IF" <Expr>
   "THEN" <Action Body>
   "ELSE" <Action Body>
           
<Unchanged> ::=
    "UNCHANGED <<" <Variable> ["," <Variable>]* ">>" 
  | <Variable> "' =" <Variable>

THE GRAMMAR OF ASTs.
-------------------
See PlusCal.tla

DATA STRUCTURE FOR MAPPING
--------------------------

Location == [line : LineNumber, col : ColumnNumber]
RegionLoc == [begin : Location, end : Location]

A mapping specifier is a sequence of the following objects:

Paren == [type       : {"begin", "end"} ,
          subType    : {"expression", 
                        "1-1"      used for the def region
                        }
          tlaLoc     : Location,
          pcalRegion : Seq(RegionLoc)]
  \* Matching parens logically contain the same pcalRegion
  \* values.  However, it might be most convenient to 
  \* put them only in the end paren.

Token == [type : {"token"},
          subType : {"expression"},
          tlaRegion  : RegionLoc,
          pcalRegion : RegionLoc]

Filler == [type : {"filler"},
           tlaRegion : RegionLoc]
  \* This is like "EXCEPT", saying that if this is selected, then
  \* the tlaRegion is determined by the Parens enclosing this object.

Break == [type      : {"break"},
          tlaRegion : RegionLoc]
  \* This indicates the existence of text in the PlusCal code
  \* that is not part of the region mapped to by the objects
  \* at the current paren depth.  Hence, a TLA+ region at the 
  \* break's paren depth that contains the break maps to a
  \* disconnected regions of the PlusCal code.
  

NOTES
-----
- If the translator is modified to use a single TLA+ variable for
two different local PCal variables of the same name, then a variable
name in the TLA+ spec does not map to a unique piece of PCal code
in the <Variables Declaration> and <Init Definition>.  And additional
information will need to be kept to map variable names to the correct
PCal declaration for cases where there is a unique mapping.

- For a multi-assignment such as 

   x[i] := ... || x[j] := ...
   
the <Variable> of an <Assignment> does not correspond to a unique
occurrence of the variable in the PCal code.

- Among the stuff added in the translation are parentheses around expressions.

- The definition section should be handled by a 1-1 mapping between an area 
  of the spec and an area of the code.  That must be fit into any framework.

